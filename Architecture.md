# Architecture

## Overview

The architecture is designed to utilize the resources we have in maximum and provide a secure and high-available infrastructure that can be deployed easily. Some services are run on a single server together in order to reduce the number of phisical servers needed. But if the scale is going larger and larger in the future, it is very possible to isolate them and even balance their load using softwares like HAProxy. When any one controller node fail, software like Pacemaker will react instantly, which ensures that there is no single point of failure. Duplicate storage node also provide sufficient redundant. To esure the service is stable all the time, there is a development enviroment aside from the production one to experiment new features before deploying to production. The two systems are completely seperated, but configure management tool like Puppet facilitate us to syncronized them if needed. 

## Development Enviroment

Developemet enviroment is a miniature of production one. This system is consisted of two physical server. One for Creator, the server that provides auto-deployment. The other one host lots of virtual machines to simulate the production enviroment. The simulated production enviroment enable us to experiment new configuration or new feature without under the risk of crash production enviromment. And the isolated Creator server can let us experiment auto deployment one bare phisical machine moreover.
![](http://csie-cloud.github.io/wiki/images/dev-env.svg)

## Production Enviroment 
![Production](http://csie-cloud.github.io/wiki/images/arch.svg)

The design of production enviroment can be considered in following aspects:
 * Auto-Deployment
 * Security
 * High-Availability

### Auto-Deployment

We use Creator server to achieve auto deployment. For example, if you want to add a compute node in the future, what you have to do is 
 1.  Go to 215 to plugin correct network cable.
 2.  Login Creator server.
 2.  Run a few commands.

When you want to deploy an experiented configuration, what you have to do is
 1.  Login Creator.
 2.  Pull down the cnifguration file from somewhere.
 3.  Rum a few commands.

Now you have more time sleep in your bed. :)

### Security
#### Seperate of VMs Network and cloud internal network
There are three segments of netwrok.
 * Public Network (blue lines)
 * Cloud Internal Network (black lines)
 * VMs traffic network (red lines)

The public network is the network directly connect to public world.

The cloud internal network is for cloud infrastructure management and functions. Servers that only connect to internal network can not be directly accessed from public netwrok as well as VMs on compute nodes. Therefore, services like storage, Creator are protected from attack from public network.  

The VMs traffic network allows VMs to access public network through NAT provided by Neutron as well as inter-VM communication. But the inter-VM communication can be restricted by Neutron.

#### Particular service consideration 

#### Log
Log should be the last line of defence. Therefore, it should be protected very well and thus be put in internal network.

Service like rsyslog managing log generated by cloud infrastructure hosts like controllers, storage and etc must be in internal network, because some of those server are only connected cloud internal netwrok. And the log server management server that can only be accessed from internal netwrok provide higher security. Therefore, there is a log server (utility server) in the architecture design. It is also hoped that we can make the log stored in the log server read-only somehow. Also, number users having root priviledge of that log server should be minimized. 

In addition, log generated by CSIE service like mail server or those of big size can be archived and "push" to the object storage service, which may be built using NAS. For example, Neutron can send packet log to object storage. Or the utility server can store log that is too old to object storage.

##### LDAP
Since LDAP sever do not only provide service to this cloud infrastructure, but also other CSIE services like mail server, linux* server, it is difficult to put LDAP in cloud internal network. It is more appropriate to make it run as an instance of compute node. And since it is exposed wider services, it should not store the authentication information of ifrastructure administrators.

##### Creator
Maybe it should be off-line when not used.

### High-Availability
Each important service, like controller, storage is planned to have replica. If servers that face public network crash, pacemaker will detect its replica's failure, and start some mechanism. And for the service accessed by internal network, the HAProxy on the controller will auto balance the load of API-service like Nova-api, Cinder-api and so on.
